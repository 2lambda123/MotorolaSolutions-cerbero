From afead5a6d801eaa13385dcd0942bfe4484e7dddc Mon Sep 17 00:00:00 2001
From: Nirbheek Chauhan <nirbheek@centricular.com>
Date: Thu, 5 Mar 2015 01:39:04 +0530
Subject: [PATCH 1/3] bindings/java: Temporary fix for generating java bindings
 from gir

This broke with the addition of the DataChannel feature
---
 bindings/java/gir_parser.py     | 9 ++++++++-
 bindings/java/standard_types.py | 4 ++++
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/bindings/java/gir_parser.py b/bindings/java/gir_parser.py
index 0f21394..c9bf5bf 100644
--- a/bindings/java/gir_parser.py
+++ b/bindings/java/gir_parser.py
@@ -533,5 +533,12 @@ class GirParser(object):
         return aliases
 
     def parse_full(self, type_registry):
-        return [Namespace(type_registry, tag) for tag in self.xml_root.findall(TAG_NAMESPACE)]
+        parsed = []
+        for tag in self.xml_root.findall(TAG_NAMESPACE):
+            try:
+                parsed.append(Namespace(type_registry, tag))
+            except LookupError:
+                # Ignore the error
+                print("Unable to parse namespace tag: " + str(tag))
+        return parsed
 
diff --git a/bindings/java/standard_types.py b/bindings/java/standard_types.py
index 8b61425..ef25525 100644
--- a/bindings/java/standard_types.py
+++ b/bindings/java/standard_types.py
@@ -197,6 +197,8 @@ class PrimitiveMetaType(GirMetaType):
 
 class CharType   (PrimitiveMetaType('byte',    'jbyte',    'gchar',    'B', 'Char')): pass
 class UcharType  (PrimitiveMetaType('byte',    'jbyte',    'guchar',   'B', 'Char')): pass
+class ShortType  (PrimitiveMetaType('int',     'jint',     'gint16',   'I', 'Integer')): pass
+class UshortType (PrimitiveMetaType('int',     'jint',     'guint16',  'I', 'Integer')): pass
 class IntType    (PrimitiveMetaType('int',     'jint',     'gint',     'I', 'Integer')): pass
 class UintType   (PrimitiveMetaType('int',     'jint',     'guint',    'I', 'Integer')): pass
 class LongType   (PrimitiveMetaType('long',    'jlong',    'glong',    'J', 'Long')): pass
@@ -538,6 +540,8 @@ standard_types = [
     VoidType,
     CharType,
     UcharType,
+    ShortType,
+    UshortType,
     IntType,
     UintType,
     Int64Type,
-- 
2.1.0


From a774ee0b395fe67abea14a1022e3c7b50907b891 Mon Sep 17 00:00:00 2001
From: Nirbheek Chauhan <nirbheek@centricular.com>
Date: Mon, 9 Mar 2015 18:52:46 +0530
Subject: [PATCH 2/3] bindings/java: Fix build; the OWRTC packages have changed
 slightly

---
 bindings/java/Makefile.am | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/bindings/java/Makefile.am b/bindings/java/Makefile.am
index 643defe..9eeaf08 100644
--- a/bindings/java/Makefile.am
+++ b/bindings/java/Makefile.am
@@ -27,7 +27,6 @@ libopenwebrtc_bridge_jni_la_LIBADD = \
 BUILT_SOURCES = owr_jni.c
 noinst_DATA = \
 	gen/owr/com/ericsson/research \
-	gen/owr/com/ericsson/research/owr \
 	gen/bridge/com/ericsson/research/owr \
 	javadoc
 CLEANFILES = owr_jni.c owr gen javadoc
@@ -57,7 +56,7 @@ gen/owr/%: owr/%
 	$(JAVAC) -classpath '$(ANDROID_CLASSPATH):gen/owr/' -d gen/owr $+/*.java
 
 javadoc: owr
-	$(JAVADOC) -d javadoc -sourcepath owr -subpackages com.ericsson.research.owr -classpath '$(ANDROID_CLASSPATH)'
+	$(JAVADOC) -d javadoc -sourcepath owr -subpackages com.ericsson.research -classpath '$(ANDROID_CLASSPATH)'
 
 # This must be done in install because we need the installed version of
 # the shared library created by libtool, not the "uninstalled" version
@@ -70,12 +69,10 @@ install-data-local: install-exec
 		cp -L $$eachlib jar-build/lib/armeabi; \
 	done
 	$(JAR) cvf '$(DESTDIR)/$(jardir)/openwebrtc.jar' \
-		-C gen/owr com/ericsson/research/owr \
 		-C gen/owr com/ericsson/research \
 		-C jar-build lib/armeabi/libopenwebrtc.so \
 		-C jar-build lib/armeabi/libopenwebrtc_jni.so
 	$(JAR) cvf '$(DESTDIR)/$(jardir)/openwebrtc-source.jar' \
-		-C owr com/ericsson/research/owr \
 		-C owr com/ericsson/research
 	$(JAR) cvf '$(DESTDIR)/$(jardir)/openwebrtc_bridge.jar' \
 		-C gen/bridge com/ericsson/research/owr \
-- 
2.1.0


From 4346e15fa83c128cb9bdd1518884334cb674e70c Mon Sep 17 00:00:00 2001
From: Nirbheek Chauhan <nirbheek@centricular.com>
Date: Mon, 9 Mar 2015 19:00:49 +0530
Subject: [PATCH 3/3] bindings/java: Fix typo in env variable

---
 bindings/java/Makefile.am | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bindings/java/Makefile.am b/bindings/java/Makefile.am
index 9eeaf08..6c22437 100644
--- a/bindings/java/Makefile.am
+++ b/bindings/java/Makefile.am
@@ -39,7 +39,7 @@ OWR_GIR = Owr-0.1.gir
 endif
 
 owr_jni.c: $(OWR_GIR) $(top_srcdir)/bindings/java/
-	PYTHONDONTWRITEBYTECODE=x $(top_srcdir)/bindings/java/gen_jni.py \
+	PYTHONDONTWRITEBYTECODE=1 $(top_srcdir)/bindings/java/gen_jni.py \
 	--gir=$< \
 	--c-out=$(top_builddir)/bindings/java/owr_jni.c \
 	--j-out=$(top_builddir)/bindings/java/owr
-- 
2.1.0

